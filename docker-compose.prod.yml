# Production overrides
services:
  api:
    build:
      target: production
    restart: always
    environment:
      ENVIRONMENT: production
      DEBUG: "false"
    volumes:
      - uploads_data:/app/uploads
      - published_data:/app/published
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - custom_ssl_data:/etc/custom-ssl
      - acme_webroot:/var/www/acme
      - ./nginx/ssl-sites:/etc/nginx/ssl-sites

  worker:
    build:
      target: production
    restart: always
    command: celery -A app.celery_app worker --loglevel=warning --concurrency=4
    volumes:
      - uploads_data:/app/uploads
      - published_data:/app/published

  nginx:
    restart: always
    ports:
      - "443:443"
    volumes:
      - /etc/letsencrypt:/etc/letsencrypt:ro
      - custom_ssl_data:/etc/custom-ssl:ro
      - acme_webroot:/var/www/acme
      - ./nginx/ssl-sites:/etc/nginx/ssl-sites:ro

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      target: production
    container_name: sb-frontend
    restart: always
    depends_on:
      - api
